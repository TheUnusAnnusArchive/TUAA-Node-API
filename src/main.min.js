"use strict";function makeRequest(e){return new Promise(function(t,r){axios_1.default.get(e).then(function(e){t(e.data)}).catch(r)})}var __awaiter=this&&this.__awaiter||function(e,t,r,n){function a(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,i){function s(e){try{o(n.next(e))}catch(e){i(e)}}function u(e){try{o(n.throw(e))}catch(e){i(e)}}function o(e){e.done?r(e.value):a(e.value).then(s,u)}o((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(s=o.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,i,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var axios_1=__importDefault(require("axios")),form_data_1=__importDefault(require("form-data")),fs_1=__importDefault(require("fs")),pocketbase_1=__importDefault(require("pocketbase")),moment_1=__importDefault(require("moment")),TUAA=function(){function e(e,t){void 0===e&&(e="https://db.unusann.us"),void 0===t&&(t="https://unusann.us/api");var r=this;this.endpoints={roku:{v1:{feed:function(){return makeRequest("".concat(r.apiUrl,"/roku/v1/feed"))}}},swift:{v1:{getallmetadata:function(){return makeRequest("".concat(r.apiUrl,"/swift/v1/getallmetadata"))}}},v1:{getallmetadata:function(){return makeRequest("".concat(r.apiUrl,"/v1/getallmetadata"))},gets00metadata:function(){return makeRequest("".concat(r.apiUrl,"/v1/gets00metadata"))},gets01metadata:function(){return makeRequest("".concat(r.apiUrl,"/v1/gets01metadata"))},getvideodata:function(e){return makeRequest("".concat(r.apiUrl,"/v1/getvideodata/").concat(e))},getvidpreviews:function(e){return makeRequest("".concat(r.apiUrl,"/v1/getvidpreviews/").concat(e))}},v2:{metadata:{episode:function(e){return makeRequest("".concat(r.apiUrl,"/v2/metadata/episode/").concat(e))},season:{s00:function(){return makeRequest("".concat(r.apiUrl,"/v2/metadata/season/s00"))},s01:function(){return makeRequest("".concat(r.apiUrl,"/v2/metadata/season/s01"))}},all:function(){return makeRequest("".concat(r.apiUrl,"/v2/metadata/all"))}},preview:function(e){return makeRequest("".concat(r.apiUrl,"/v2/preview/").concat(e))}},subtitles:function(e){return makeRequest("".concat(r.apiUrl,"/subtitles?url=").concat(encodeURIComponent(e)))}},this.metadata=this.endpoints.v2.metadata,this.preview=this.endpoints.v2.preview,this.subtitles=this.endpoints.subtitles,this.account={changepfp:function(e){return __awaiter(r,void 0,void 0,function(){var t,r;return __generator(this,function(n){switch(n.label){case 0:return t="string"==typeof e?fs_1.default.readFileSync(e):e,r=new form_data_1.default,r.append("avatar",t),[4,this.pb.records.update("profiles",this.pbUser.profile.id)];case 1:return[2,n.sent()]}})})},login:function(e,t){return __awaiter(r,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return[4,this.pb.users.authViaEmail(e,t)];case 1:return r=n.sent(),this.pbUser=r.user,[2,r]}})})},logout:function(){return r.pb.authStore.clear()},signup:function(e,t,n,a){return __awaiter(r,void 0,void 0,function(){var r,i;return __generator(this,function(s){switch(s.label){case 0:return[4,this.pb.users.create({email:t,password:n,passwordConfirm:a})];case 1:return r=s.sent(),[4,this.pb.users.authViaEmail(t,n)];case 2:return s.sent(),[4,this.pb.records.update("profiles",r.profile.id,{name:e,emails_account:!0,emails_updates:!1})];case 3:return s.sent(),[4,this.pb.users.requestVerification(t)];case 4:return s.sent(),[4,this.pb.users.getOne(r.id)];case 5:return i=s.sent(),[2,this.pbUser=i]}})})},setEmailPreferences:function(e){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.pb.records.update("profiles",this.pbUser.profile.id,{emails_account:e.account,emails_updates:e.updates})];case 1:return t.sent(),this.pbUser.profile.emails_account=e.account,this.pbUser.profile.emails_updates=e.updates,[2,this.pbUser]}})})},sendEmailVerification:function(){return r.pb.users.requestVerification(r.pbUser.email)},resetEmail:function(e){return r.pb.users.requestEmailChange(e)},resetPassword:function(){return r.pb.users.requestPasswordReset(r.pbUser.email)},deleteAccount:function(e,t){return __awaiter(r,void 0,void 0,function(){var r,n;return __generator(this,function(a){switch(a.label){case 0:return e!==t?[3,5]:[4,this.pb.users.authViaEmail(this.pbUser.email,e)];case 1:return r=a.sent(),r.token?[4,this.pb.users.delete(r.user.id)]:[3,3];case 2:return n=a.sent(),[2,n];case 3:throw"Invalid login!";case 4:return[3,6];case 5:throw"Password and confirm password do not match!";case 6:return[2]}})})}},this.comments={getComments:function(e,t,n,a){return void 0===n&&(n=1),void 0===a&&(a=400),__awaiter(r,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.pb.records.getList("comments",n,a,{filter:'episode="'.concat(e,'"'),$autoCancel:!1})];case 1:return r=i.sent().items,"latest"===t||"oldest"===t?r.sort(function(e,t){var r=moment_1.default.utc(e.created).unix(),n=moment_1.default.utc(t.created).unix();return r>n?-1:r<n?1:r===n?0:void 0}):"rating"===t&&r.sort(function(e,t){var r=e.likes-e.dislikes,n=t.likes-t.dislikes;if(r>n)return-1;if(r<n)return 1;if(r===n){var a=moment_1.default.utc(e.created).unix(),i=moment_1.default.utc(t.created).unix();if(a>i)return-1;if(a<i)return 1;if(a===i)return 0}}),"oldest"===t&&r.reverse(),[2,r]}})})},postComment:function(e,t){return __awaiter(r,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return r=t.trim(),0===r.length?[2]:[4,this.pb.records.create("comments",{episode:e,markdown:r,user:this.pbUser.id})];case 1:return[2,n.sent()]}})})},deleteComment:function(e){return r.pb.records.delete("comments",e)},editComment:function(e,t){var n=t.trim();if(0!==n.length)return r.pb.records.update("comments",e,{markdown:n,isEdited:!0})}},this.pb=new pocketbase_1.default(e),this.apiUrl=t}return e}();exports.default=TUAA;